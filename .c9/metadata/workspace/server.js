{"changed":true,"filter":false,"title":"server.js","tooltip":"/server.js","value":"var express = require('express');\nvar app = express();\nvar escape = require('escape-html');\nvar ascii = require('ascii-art');\nvar morgan = require('morgan');\nvar hogan = require('hogan-express');\nvar allBooks = {};\nvar request = require('request');\nvar http = require('http').Server(app);\nvar io = require('socket.io')(http);\nvar _ = require('lodash');\n\napp.set('view engine', 'html');\napp.engine('html', hogan);\napp.set('views', './views');\napp.use(morgan(\"default\"));\n\napp.get('/', function (req, res) {\n  if (req.query.name) {\n    res.send('Hello ' + req.query.name + ', you\\'re the best!');\n  }\n  else {\n    res.send('Please set a value for name');\n  }\n});\n\napp.get('/d/:num1', function (req, res) {\n  res.send(req.params.num1);\n});\n\napp.get('/sum/:num1/:num2', function (req, res) {\n  var sum = parseInt(req.params.num1) + parseInt(req.params.num2);\n  res.send(' ' + sum);\n});\n\napp.get('/times/:num1/:num2', function (req, res) {\n  var times = parseInt(req.params.num1) * parseInt(req.params.num2);\n  res.send(' ' + times);\n});\n\napp.get('/escape', function (req, res) {\n  res.send(escape('<p>hello</p>'));\n});\n\napp.get('/ascii/:name', function (req, res) {\n  ascii.font(req.params.name, 'Doom', function(rendered){\n    res.send('<pre>' + rendered + '</pre>');\n  });\n});\n\napp.use('/static', express.static('public'));\n\napp.get('/form', function (req, res) {\n  if (req.query.name) {\n\n    var date = req.query.dob.month + '/' + req.query.dob.day + '/' + req.query.dob.year;\n\n    res.locals = {name:req.query.name, shoesize:req.query.shoesize, favcolour:req.query.favcolour, dob:date};\n    res.render('details');\n  }\n  \n  else {\n    res.redirect('/static');\n  }\n});\n\napp.get('/addBook', function(req, res) {\n    if (req.query.code){\n      var ISBN = req.query.code;\n      if (/^\\d{13}$/.test(ISBN)) {\n          request('http://ISBNDB.com/api/v2/json/XW09D335/book/' + ISBN, function (error, response, body) {\n          var isbnLookupResult = JSON.parse(body);\n          if (!error && response.statusCode === 200 && isbnLookupResult.data && isbnLookupResult.data[0]) {\n            // console.log(isbnLookupResult.data[0]);\n            var bookDetails = {};\n            if (isbnLookupResult.data[0].author_data && isbnLookupResult.data[0].author_data[0] && isbnLookupResult.data[0].author_data[0].name) {\n              bookDetails.author = isbnLookupResult.data[0].author_data[0].name;\n            }\n            else {\n              bookDetails.author = \"Unknown\";\n            }\n            if (isbnLookupResult.data[0].title_long) {\n              bookDetails.title = isbnLookupResult.data[0].title_long;\n            }\n            else {\n              bookDetails.title = isbnLookupResult.data[0].title;\n            }\n            if (isbnLookupResult.data[0].publisher_name) {\n              bookDetails.publisher = isbnLookupResult.data[0].publisher_name;\n            }\n            else {\n              bookDetails.publisher = \"Unknown\";\n            }\n            bookDetails.ISBN = ISBN;\n            allBooks[ISBN] = bookDetails;\n            res.send('ISBN added to collection :)');\n            io.emit('Book added :)', bookDetails);\n          }\n        });\n      }\n      else {\n        res.status(400).send(\"Invalid ISBN.\");\n      }\n    }\n    else {\n      res.send('Enter the format and code.');\n    }\n});\n\napp.get('/removeBook', function(req, res) {\n  console.log('#########');\n  if (req.query.code){\n    var ISBN = req.query.code;\n    if (allBooks[ISBN]) {\n      delete allBooks[ISBN];\n      res.send('Book deleted');\n    }\n    else {\n      res.send('ISBN not in table');  \n    }\n  }\n  else {\n    res.send('Enter ISBN');\n  }\n});\n\napp.get('/empty', function(req,res) {\n  allBooks = [];\n  res.send(allBooks);\n});\n\napp.get('/table', function(req,res) {\n  res.render('table', {result: _.values(allBooks)});\n});\n\nio.on('connection', function(socket){\n  // console.log('a user connected');\n  socket.on('disconnect', function(){\n    // console.log('user disconnected');\n  });\n});\n\nhttp.listen(process.env.PORT || 3000, function () {\n  // console.log('Example app listening on port 3000!');\n});","undoManager":{"mark":100,"position":100,"stack":[[{"start":{"row":110,"column":14},"end":{"row":110,"column":15},"action":"remove","lines":["|"],"id":687}],[{"start":{"row":110,"column":14},"end":{"row":110,"column":15},"action":"insert","lines":["\\"],"id":688}],[{"start":{"row":110,"column":15},"end":{"row":110,"column":16},"action":"insert","lines":["\\"],"id":689}],[{"start":{"row":110,"column":16},"end":{"row":110,"column":17},"action":"insert","lines":["\\"],"id":690}],[{"start":{"row":110,"column":17},"end":{"row":110,"column":18},"action":"insert","lines":["|"],"id":691}],[{"start":{"row":110,"column":18},"end":{"row":110,"column":19},"action":"insert","lines":["|"],"id":692}],[{"start":{"row":110,"column":19},"end":{"row":110,"column":20},"action":"insert","lines":["|"],"id":693}],[{"start":{"row":110,"column":20},"end":{"row":110,"column":21},"action":"insert","lines":["#"],"id":694}],[{"start":{"row":110,"column":19},"end":{"row":110,"column":20},"action":"remove","lines":["|"],"id":695}],[{"start":{"row":110,"column":18},"end":{"row":110,"column":19},"action":"remove","lines":["|"],"id":696}],[{"start":{"row":110,"column":17},"end":{"row":110,"column":18},"action":"remove","lines":["|"],"id":697}],[{"start":{"row":110,"column":16},"end":{"row":110,"column":17},"action":"remove","lines":["\\"],"id":698}],[{"start":{"row":110,"column":15},"end":{"row":110,"column":16},"action":"remove","lines":["\\"],"id":699}],[{"start":{"row":110,"column":14},"end":{"row":110,"column":15},"action":"remove","lines":["\\"],"id":700}],[{"start":{"row":110,"column":14},"end":{"row":110,"column":15},"action":"insert","lines":["#"],"id":701}],[{"start":{"row":110,"column":15},"end":{"row":110,"column":16},"action":"insert","lines":["#"],"id":702}],[{"start":{"row":110,"column":16},"end":{"row":110,"column":17},"action":"insert","lines":["#"],"id":703}],[{"start":{"row":110,"column":17},"end":{"row":110,"column":18},"action":"insert","lines":["#"],"id":704}],[{"start":{"row":110,"column":18},"end":{"row":110,"column":19},"action":"insert","lines":["#"],"id":705}],[{"start":{"row":110,"column":19},"end":{"row":110,"column":20},"action":"insert","lines":["#"],"id":706}],[{"start":{"row":110,"column":20},"end":{"row":110,"column":21},"action":"insert","lines":["#"],"id":707}],[{"start":{"row":110,"column":21},"end":{"row":110,"column":22},"action":"insert","lines":["#"],"id":708}],[{"start":{"row":110,"column":14},"end":{"row":110,"column":15},"action":"insert","lines":["'"],"id":709}],[{"start":{"row":110,"column":24},"end":{"row":110,"column":25},"action":"insert","lines":["'"],"id":710}],[{"start":{"row":132,"column":0},"end":{"row":132,"column":24},"action":"remove","lines":["  console.log(allBooks);"],"id":711}],[{"start":{"row":131,"column":52},"end":{"row":132,"column":0},"action":"remove","lines":["",""],"id":712}],[{"start":{"row":114,"column":27},"end":{"row":115,"column":0},"action":"insert","lines":["",""],"id":713},{"start":{"row":115,"column":0},"end":{"row":115,"column":6},"action":"insert","lines":["      "]}],[{"start":{"row":115,"column":6},"end":{"row":115,"column":7},"action":"insert","lines":["r"],"id":714}],[{"start":{"row":115,"column":7},"end":{"row":115,"column":8},"action":"insert","lines":["e"],"id":715}],[{"start":{"row":115,"column":8},"end":{"row":115,"column":9},"action":"insert","lines":["s"],"id":716}],[{"start":{"row":115,"column":9},"end":{"row":115,"column":10},"action":"insert","lines":["."],"id":717}],[{"start":{"row":115,"column":10},"end":{"row":115,"column":11},"action":"insert","lines":["s"],"id":718}],[{"start":{"row":115,"column":11},"end":{"row":115,"column":12},"action":"insert","lines":["e"],"id":719}],[{"start":{"row":115,"column":12},"end":{"row":115,"column":13},"action":"insert","lines":["n"],"id":720}],[{"start":{"row":115,"column":13},"end":{"row":115,"column":14},"action":"insert","lines":["d"],"id":721}],[{"start":{"row":115,"column":14},"end":{"row":115,"column":16},"action":"insert","lines":["()"],"id":722}],[{"start":{"row":115,"column":15},"end":{"row":115,"column":17},"action":"insert","lines":["''"],"id":723}],[{"start":{"row":115,"column":16},"end":{"row":115,"column":17},"action":"insert","lines":["b"],"id":724}],[{"start":{"row":115,"column":17},"end":{"row":115,"column":18},"action":"insert","lines":["o"],"id":725}],[{"start":{"row":115,"column":17},"end":{"row":115,"column":18},"action":"remove","lines":["o"],"id":726}],[{"start":{"row":115,"column":16},"end":{"row":115,"column":17},"action":"remove","lines":["b"],"id":727}],[{"start":{"row":115,"column":16},"end":{"row":115,"column":17},"action":"insert","lines":["B"],"id":728}],[{"start":{"row":115,"column":17},"end":{"row":115,"column":18},"action":"insert","lines":["o"],"id":729}],[{"start":{"row":115,"column":18},"end":{"row":115,"column":19},"action":"insert","lines":["o"],"id":730}],[{"start":{"row":115,"column":19},"end":{"row":115,"column":20},"action":"insert","lines":["k"],"id":731}],[{"start":{"row":115,"column":20},"end":{"row":115,"column":21},"action":"insert","lines":[" "],"id":732}],[{"start":{"row":115,"column":21},"end":{"row":115,"column":22},"action":"insert","lines":["d"],"id":733}],[{"start":{"row":115,"column":22},"end":{"row":115,"column":23},"action":"insert","lines":["e"],"id":734}],[{"start":{"row":115,"column":23},"end":{"row":115,"column":24},"action":"insert","lines":["l"],"id":735}],[{"start":{"row":115,"column":24},"end":{"row":115,"column":25},"action":"insert","lines":["e"],"id":736}],[{"start":{"row":115,"column":25},"end":{"row":115,"column":26},"action":"insert","lines":["t"],"id":737}],[{"start":{"row":115,"column":26},"end":{"row":115,"column":27},"action":"insert","lines":["e"],"id":738}],[{"start":{"row":115,"column":27},"end":{"row":115,"column":28},"action":"insert","lines":["d"],"id":739}],[{"start":{"row":114,"column":11},"end":{"row":114,"column":12},"action":"remove","lines":["e"],"id":740}],[{"start":{"row":114,"column":10},"end":{"row":114,"column":11},"action":"remove","lines":["t"],"id":741}],[{"start":{"row":114,"column":9},"end":{"row":114,"column":10},"action":"remove","lines":["e"],"id":742}],[{"start":{"row":114,"column":8},"end":{"row":114,"column":9},"action":"remove","lines":["l"],"id":743}],[{"start":{"row":114,"column":7},"end":{"row":114,"column":8},"action":"remove","lines":["e"],"id":744}],[{"start":{"row":114,"column":6},"end":{"row":114,"column":7},"action":"remove","lines":["d"],"id":745}],[{"start":{"row":114,"column":6},"end":{"row":114,"column":7},"action":"remove","lines":[" "],"id":746}],[{"start":{"row":114,"column":19},"end":{"row":114,"column":20},"action":"remove","lines":[";"],"id":747}],[{"start":{"row":114,"column":19},"end":{"row":114,"column":20},"action":"insert","lines":[" "],"id":748}],[{"start":{"row":114,"column":20},"end":{"row":114,"column":21},"action":"insert","lines":["="],"id":749}],[{"start":{"row":114,"column":21},"end":{"row":114,"column":22},"action":"insert","lines":[" "],"id":750}],[{"start":{"row":114,"column":22},"end":{"row":114,"column":24},"action":"insert","lines":["''"],"id":751}],[{"start":{"row":114,"column":23},"end":{"row":114,"column":24},"action":"remove","lines":["'"],"id":752}],[{"start":{"row":114,"column":22},"end":{"row":114,"column":23},"action":"remove","lines":["'"],"id":753}],[{"start":{"row":114,"column":22},"end":{"row":114,"column":23},"action":"insert","lines":["u"],"id":754}],[{"start":{"row":114,"column":23},"end":{"row":114,"column":24},"action":"insert","lines":["n"],"id":755}],[{"start":{"row":114,"column":24},"end":{"row":114,"column":25},"action":"insert","lines":["d"],"id":756}],[{"start":{"row":114,"column":25},"end":{"row":114,"column":26},"action":"insert","lines":["e"],"id":757}],[{"start":{"row":114,"column":26},"end":{"row":114,"column":27},"action":"insert","lines":["f"],"id":758}],[{"start":{"row":114,"column":27},"end":{"row":114,"column":28},"action":"insert","lines":["i"],"id":759}],[{"start":{"row":114,"column":28},"end":{"row":114,"column":29},"action":"insert","lines":["n"],"id":760}],[{"start":{"row":114,"column":29},"end":{"row":114,"column":30},"action":"insert","lines":["e"],"id":761}],[{"start":{"row":114,"column":30},"end":{"row":114,"column":31},"action":"insert","lines":["d"],"id":762}],[{"start":{"row":114,"column":31},"end":{"row":114,"column":32},"action":"insert","lines":[";"],"id":763}],[{"start":{"row":115,"column":30},"end":{"row":115,"column":31},"action":"insert","lines":[";"],"id":764}],[{"start":{"row":122,"column":26},"end":{"row":122,"column":27},"action":"insert","lines":[";"],"id":765}],[{"start":{"row":113,"column":17},"end":{"row":113,"column":18},"action":"insert","lines":["'"],"id":766}],[{"start":{"row":113,"column":22},"end":{"row":113,"column":23},"action":"insert","lines":["'"],"id":767}],[{"start":{"row":113,"column":22},"end":{"row":113,"column":23},"action":"remove","lines":["'"],"id":768}],[{"start":{"row":113,"column":17},"end":{"row":113,"column":18},"action":"remove","lines":["'"],"id":769}],[{"start":{"row":114,"column":14},"end":{"row":114,"column":15},"action":"remove","lines":["."],"id":770}],[{"start":{"row":114,"column":14},"end":{"row":114,"column":15},"action":"insert","lines":["{"],"id":771}],[{"start":{"row":114,"column":15},"end":{"row":114,"column":16},"action":"insert","lines":["["],"id":772}],[{"start":{"row":114,"column":15},"end":{"row":114,"column":16},"action":"remove","lines":["["],"id":773}],[{"start":{"row":114,"column":14},"end":{"row":114,"column":15},"action":"remove","lines":["{"],"id":774}],[{"start":{"row":114,"column":14},"end":{"row":114,"column":15},"action":"insert","lines":["["],"id":775}],[{"start":{"row":114,"column":19},"end":{"row":114,"column":20},"action":"insert","lines":["]"],"id":776}],[{"start":{"row":114,"column":21},"end":{"row":114,"column":33},"action":"remove","lines":["= undefined;"],"id":777}],[{"start":{"row":114,"column":20},"end":{"row":114,"column":21},"action":"remove","lines":[" "],"id":778}],[{"start":{"row":114,"column":6},"end":{"row":114,"column":7},"action":"insert","lines":["d"],"id":779}],[{"start":{"row":114,"column":7},"end":{"row":114,"column":8},"action":"insert","lines":["e"],"id":780}],[{"start":{"row":114,"column":8},"end":{"row":114,"column":9},"action":"insert","lines":["l"],"id":781}],[{"start":{"row":114,"column":9},"end":{"row":114,"column":10},"action":"insert","lines":["e"],"id":782}],[{"start":{"row":114,"column":10},"end":{"row":114,"column":11},"action":"insert","lines":["t"],"id":783}],[{"start":{"row":114,"column":11},"end":{"row":114,"column":12},"action":"insert","lines":["e"],"id":784}],[{"start":{"row":114,"column":12},"end":{"row":114,"column":13},"action":"insert","lines":[" "],"id":785}],[{"start":{"row":114,"column":27},"end":{"row":114,"column":28},"action":"insert","lines":[";"],"id":786}],[{"start":{"row":110,"column":26},"end":{"row":110,"column":27},"action":"insert","lines":[";"],"id":787}]]},"ace":{"folds":[],"customSyntax":"javascript","scrolltop":1445,"scrollleft":0,"selection":{"start":{"row":134,"column":0},"end":{"row":134,"column":0},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":{"row":102,"state":"no_regex","mode":"ace/mode/javascript"}},"timestamp":1467651240283}